#!/bin/sh -ex

echo "*\n*\n* building bullet\n*\n*"
cd @CMAKE_CURRENT_BINARY_DIR@
mkdir -p 3rdparty
cd 3rdparty

TARBALL_NAME=bullet-2.76-patched2
TARBALL=build/${TARBALL_NAME}.tar.gz
TARBALL_URL=http://pr.willowgarage.com/downloads/${TARBALL_NAME}.tar.gz
BULLET_TARGETS="LinearMath BulletCollision BulletDynamics BulletSoftBody"

wget -c $TARBALL_URL
tar xvzf $TARBALL_NAME.tar.gz

cd bullet_svn
cmake -DCMAKE_INSTALL_PREFIX=@CMAKE_CURRENT_BINARY_DIR@ -DCMAKE_CXX_FLAGS="-fPIC -DBT_USE_DOUBLE_PRECISION" -DBUILD_SHARED_LIBS=ON -DINSTALL_LIBS=ON -DBUILD_DEMOS=OFF .
make $BULLET_TARGETS
make install
#
#  Duct-tape install
#


echo "Done."